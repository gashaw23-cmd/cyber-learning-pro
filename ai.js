(function(){const sel=document.getElementById('themeSel');const apply=m=>{const r=document.documentElement;if(m==='light')r.classList.add('light');else r.classList.remove('light');localStorage.setItem('clp_theme',m)};const saved=localStorage.getItem('clp_theme')||'dark';if(sel)sel.value=saved;apply(saved);if(sel)sel.onchange=()=>apply(sel.value);
const box=document.getElementById('summary');const data=JSON.parse(localStorage.getItem('clp_results')||'{}');if(!data||!data.total){box.innerHTML='<div class="muted">אין נתונים להצגה. חזור למבחן.</div>';return;}const pct=Math.round((data.score/data.total)*100);const weak=Object.entries((data.wrongTopics||[]).reduce((m,t)=>{m[t]=(m[t]||0)+1;return m;},{})).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([t])=>t);
box.innerHTML=`<h3>ציון: ${data.score}/${data.total} — ${pct}%</h3><ul><li><strong>חוזקות:</strong> ${pct>=80?'שליטה מצוינת.':'הבנה בסיסית טובה — יש מה לשפר.'}</li><li><strong>לשיפור:</strong> ${weak.length?weak.join(', '):'לא זוהו נושאים חלשים.'}</li><li><strong>המלצות:</strong> ${pct>=80?'נסה רמת קושי "קשה".':'צור מבחן חדש לנושאים החלשים.'}</li></ul><div class="center" style="margin-top:10px"><a href="./quiz.html" class="btn">מבחן חדש</a></div>`;
})();